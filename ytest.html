<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Tutor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        * {
            box-sizing: border-box;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // ============================================
        // ì•ˆë“œë¡œì´ë“œ NotificationListenerService ì—°ë™
        // ============================================
        
        /**
         * ì•Œë¦¼ ìˆ˜ì‹  í•¸ë“¤ëŸ¬ - NotificationListenerServiceì—ì„œ í˜¸ì¶œë¨
         * @param {Object} notificationData - ì•Œë¦¼ ë°ì´í„° ê°ì²´
         * @param {string} notificationData.packageName - ì•Œë¦¼ì„ ë³´ë‚¸ ì•±ì˜ íŒ¨í‚¤ì§€ëª…
         * @param {string} notificationData.title - ì•Œë¦¼ ì œëª©
         * @param {string} notificationData.text - ì•Œë¦¼ ë‚´ìš©
         * @param {number} notificationData.timestamp - ì•Œë¦¼ íƒ€ì„ìŠ¤íƒ¬í”„
         */
        function handleNotification(notificationData) {
            console.log('ì•Œë¦¼ ìˆ˜ì‹ :', notificationData);
            
            try {
                // processNotification í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•Œë¦¼ í…ìŠ¤íŠ¸ ì²˜ë¦¬
                if (notificationData.text && window.processNotification) {
                    window.processNotification(notificationData.text, {
                        packageName: notificationData.packageName || 'unknown',
                        title: notificationData.title || '',
                        autoTranslate: true,
                        addToChat: true
                    });
                } else {
                    // ê¸°ë³¸ ì•Œë¦¼ ë°ì´í„°ë¥¼ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ì— í‘œì‹œ
                    if (window.appInstance && window.appInstance.addNotificationMessage) {
                        window.appInstance.addNotificationMessage(notificationData);
                    } else {
                        // ì•± ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš°, ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                        if (!window.pendingNotifications) {
                            window.pendingNotifications = [];
                        }
                        window.pendingNotifications.push(notificationData);
                    }
                }
            } catch (error) {
                console.error('ì•Œë¦¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        /**
         * ì•Œë¦¼ ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
         * @returns {boolean} ê¶Œí•œì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ true
         */
        function checkNotificationPermission() {
            if (window.AndroidBridge && window.AndroidBridge.isNotificationServiceEnabled) {
                return window.AndroidBridge.isNotificationServiceEnabled();
            }
            return false;
        }

        /**
         * ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
         * ì•ˆë“œë¡œì´ë“œ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
         */
        function requestNotificationPermission() {
            if (window.AndroidBridge && window.AndroidBridge.requestNotificationPermission) {
                window.AndroidBridge.requestNotificationPermission();
            } else {
                alert('ì•ˆë“œë¡œì´ë“œ ì•±ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\nì„¤ì • > ì ‘ê·¼ì„± > ì•Œë¦¼ ì ‘ê·¼ ê¶Œí•œì—ì„œ ì•±ì„ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
            }
        }

        /**
         * ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
         * ì‚¬ìš©ì ë³µìŠµì„ ìœ„í•´ localStorageì— ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
         * 
         * @param {string} originalText - ì›ë³¸ ì•Œë¦¼ í…ìŠ¤íŠ¸ (ì˜ì–´)
         * @param {string} translation - í•œêµ­ì–´ ë²ˆì—­
         * @param {Array<string>} suggestedAnswers - ì œì•ˆëœ ë‹µë³€ 3ê°€ì§€
         * @returns {Object} ì €ì¥ ê²°ê³¼ ê°ì²´
         */
        function saveNotificationForReview(originalText, translation, suggestedAnswers = []) {
            try {
                // ì €ì¥ì†Œ í‚¤
                const STORAGE_KEY = 'notification_reviews';
                
                // ê¸°ì¡´ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
                const existingReviews = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                
                // ìƒˆ ê¸°ë¡ ê°ì²´ ìƒì„±
                const newReview = {
                    id: `review-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    originalText: originalText,
                    translation: translation,
                    suggestedAnswers: Array.isArray(suggestedAnswers) ? suggestedAnswers : [],
                    timestamp: new Date().toISOString(),
                    createdAt: Date.now()
                };
                
                // ìƒˆ ê¸°ë¡ ì¶”ê°€ (ìµœì‹ ì´ ì•ì— ì˜¤ë„ë¡)
                existingReviews.unshift(newReview);
                
                // ìµœëŒ€ ì €ì¥ ê°œìˆ˜ ì œí•œ (ìµœê·¼ 1000ê°œë§Œ ìœ ì§€)
                const MAX_REVIEWS = 1000;
                if (existingReviews.length > MAX_REVIEWS) {
                    existingReviews.splice(MAX_REVIEWS);
                }
                
                // localStorageì— ì €ì¥
                localStorage.setItem(STORAGE_KEY, JSON.stringify(existingReviews));
                
                console.log('ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ì €ì¥ ì™„ë£Œ:', newReview.id);
                
                return {
                    success: true,
                    reviewId: newReview.id,
                    totalReviews: existingReviews.length
                };
            } catch (error) {
                console.error('ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                return {
                    success: false,
                    error: error.message || 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
                };
            }
        }

        /**
         * ì €ì¥ëœ ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
         * 
         * @param {number} limit - ê°€ì ¸ì˜¬ ìµœëŒ€ ê°œìˆ˜ (ê¸°ë³¸ê°’: 50)
         * @returns {Array} ì €ì¥ëœ ê¸°ë¡ ë°°ì—´
         */
        function getNotificationReviews(limit = 50) {
            try {
                const STORAGE_KEY = 'notification_reviews';
                const reviews = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                return reviews.slice(0, limit);
            } catch (error) {
                console.error('ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                return [];
            }
        }

        /**
         * íŠ¹ì • ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ì„ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
         * 
         * @param {string} reviewId - ì‚­ì œí•  ê¸°ë¡ì˜ ID
         * @returns {boolean} ì‚­ì œ ì„±ê³µ ì—¬ë¶€
         */
        function deleteNotificationReview(reviewId) {
            try {
                const STORAGE_KEY = 'notification_reviews';
                const reviews = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                const filteredReviews = reviews.filter(review => review.id !== reviewId);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(filteredReviews));
                return true;
            } catch (error) {
                console.error('ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ì‚­ì œ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        /**
         * ì•Œë¦¼ í…ìŠ¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
         * NotificationListenerServiceë¥¼ í†µí•´ ì „ë‹¬ë°›ì€ ì•Œë¦¼ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ì²˜ë¦¬í•©ë‹ˆë‹¤.
         * 
         * @param {string} notificationText - ì²˜ë¦¬í•  ì•Œë¦¼ í…ìŠ¤íŠ¸
         * @param {Object} options - ì„ íƒì  ì˜µì…˜ ê°ì²´
         * @param {string} options.packageName - ì•Œë¦¼ì„ ë³´ë‚¸ ì•±ì˜ íŒ¨í‚¤ì§€ëª…
         * @param {string} options.title - ì•Œë¦¼ ì œëª©
         * @param {boolean} options.autoTranslate - ìë™ ë²ˆì—­ ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
         * @param {boolean} options.addToChat - ì±„íŒ…ì— ì¶”ê°€í• ì§€ ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
         * @param {boolean} options.saveForReview - ë³µìŠµìš© ì €ì¥ ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
         * @returns {Promise<Object>} ì²˜ë¦¬ ê²°ê³¼ ê°ì²´
         */
        async function processNotification(notificationText, options = {}) {
            if (!notificationText || typeof notificationText !== 'string') {
                console.warn('processNotification: ìœ íš¨í•˜ì§€ ì•Šì€ ì•Œë¦¼ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
                return { success: false, error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì•Œë¦¼ í…ìŠ¤íŠ¸' };
            }

            const {
                packageName = 'unknown',
                title = '',
                autoTranslate = true,
                addToChat = true,
                saveForReview = true
            } = options;

            try {
                console.log('ì•Œë¦¼ í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì‹œì‘:', notificationText);

                // 1. í…ìŠ¤íŠ¸ ì •ì œ (ê³µë°± ì œê±°, íŠ¹ìˆ˜ ë¬¸ì ì²˜ë¦¬)
                const cleanedText = notificationText.trim().replace(/\s+/g, ' ');

                // 2. í•œêµ­ì–´ í…ìŠ¤íŠ¸ì¸ì§€ í™•ì¸ (í•œê¸€ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€)
                const isKorean = /[ã„±-ã…|ã…-ã…£|ê°€-í£]/.test(cleanedText);
                
                // 3. í…ìŠ¤íŠ¸ ê¸¸ì´ í™•ì¸ (ë„ˆë¬´ ì§§ê±°ë‚˜ ê¸´ í…ìŠ¤íŠ¸ í•„í„°ë§)
                if (cleanedText.length < 2) {
                    console.log('ì•Œë¦¼ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤.');
                    return { success: false, error: 'í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤.' };
                }

                let finalText = cleanedText;
                if (finalText.length > 500) {
                    console.log('ì•Œë¦¼ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ì²˜ìŒ 500ìë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                    finalText = finalText.substring(0, 500);
                }

                // 4. ì²˜ë¦¬ ê²°ê³¼ ê°ì²´ ìƒì„±
                const result = {
                    success: true,
                    originalText: finalText,
                    isKorean: isKorean,
                    packageName: packageName,
                    title: title,
                    timestamp: new Date(),
                    translation: null,
                    explanation: null,
                    suggestedAnswers: []
                };

                // 5. í•œêµ­ì–´ í…ìŠ¤íŠ¸ì¸ ê²½ìš° ìë™ ë²ˆì—­ ë° ì„¤ëª… ìƒì„±
                if (isKorean && autoTranslate) {
                    try {
                        const apiKey = localStorage.getItem('gemini_api_key');
                        if (apiKey) {
                            // ë²ˆì—­ ë° ì œì•ˆ ë‹µë³€ ìš”ì²­ (í•œêµ­ì–´ -> ì˜ì–´)
                            const translatePrompt = `ë‹¤ìŒ í•œêµ­ì–´ ì•Œë¦¼ í…ìŠ¤íŠ¸ë¥¼ ì˜ì–´ë¡œ ë²ˆì—­í•˜ê³ , ê°„ë‹¨í•œ ì„¤ëª…ê³¼ í•¨ê»˜ ì´ ë¬¸ì¥ì— ëŒ€í•œ ì ì ˆí•œ ì˜ì–´ ì‘ë‹µ 3ê°€ì§€ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”. ê° ì œì•ˆëœ ì‘ë‹µì€ ì˜ì–´ì™€ í•œêµ­ì–´ ë²ˆì—­ì„ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

ì•Œë¦¼ í…ìŠ¤íŠ¸: "${finalText}"

ì‘ë‹µ í˜•ì‹ (JSONë§Œ ë°˜í™˜):
{
  "english": "ì˜ì–´ ë²ˆì—­",
  "explanation": "ì´ ë¬¸ì¥ì˜ ì˜ë¯¸ë‚˜ ë¬¸ë²• ì„¤ëª… (ê°„ë‹¨íˆ, í•œêµ­ì–´ë¡œ)",
  "suggestedAnswers": [
    {
      "english": "ì œì•ˆëœ ì‘ë‹µ 1 (ì˜ì–´)",
      "korean": "ì œì•ˆëœ ì‘ë‹µ 1 (í•œêµ­ì–´ ë²ˆì—­)"
    },
    {
      "english": "ì œì•ˆëœ ì‘ë‹µ 2 (ì˜ì–´)",
      "korean": "ì œì•ˆëœ ì‘ë‹µ 2 (í•œêµ­ì–´ ë²ˆì—­)"
    },
    {
      "english": "ì œì•ˆëœ ì‘ë‹µ 3 (ì˜ì–´)",
      "korean": "ì œì•ˆëœ ì‘ë‹µ 3 (í•œêµ­ì–´ ë²ˆì—­)"
    }
  ]
}

CRITICAL: ì‘ë‹µì€ ì˜¤ì§ JSON ë°ì´í„°ë§Œ í¬í•¨í•´ì•¼ í•˜ë©°, ë‹¤ë¥¸ ì„¤ëª…ì´ë‚˜ ì£¼ì„ì€ ì ˆëŒ€ ë„£ì§€ ë§ë¼. suggestedAnswersëŠ” ì‹¤ìš©ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ ì˜ì–´ ì‘ë‹µ 3ê°€ì§€ë¥¼ í¬í•¨í•´ì•¼ í•˜ë©°, ê° ì‘ë‹µì€ ë°˜ë“œì‹œ englishì™€ korean í•„ë“œë¥¼ ëª¨ë‘ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.`;

                            const translateResponse = await fetch(
                                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                                {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        contents: [{
                                            role: 'user',
                                            parts: [{ text: translatePrompt }]
                                        }],
                                        generationConfig: {
                                            temperature: 0.7,
                                            topK: 40,
                                            topP: 0.95,
                                            maxOutputTokens: 300,
                                            responseMimeType: 'application/json'
                                        }
                                    })
                                }
                            );

                            if (translateResponse.ok) {
                                const translateData = await translateResponse.json();
                                const translateContent = translateData.candidates[0]?.content?.parts[0]?.text;
                                
                                if (translateContent) {
                                    try {
                                        const translationJson = JSON.parse(translateContent);
                                        result.translation = translationJson.english || '';
                                        result.explanation = translationJson.explanation || '';
                                        
                                        // suggestedAnswersê°€ ê°ì²´ ë°°ì—´ì¸ì§€ ë¬¸ìì—´ ë°°ì—´ì¸ì§€ í™•ì¸
                                        const suggestedAnswers = translationJson.suggestedAnswers || [];
                                        if (suggestedAnswers.length > 0 && typeof suggestedAnswers[0] === 'object') {
                                            // ê°ì²´ ë°°ì—´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
                                            result.suggestedAnswers = suggestedAnswers;
                                        } else {
                                            // ë¬¸ìì—´ ë°°ì—´ì¸ ê²½ìš° ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜ (í•˜ìœ„ í˜¸í™˜ì„±)
                                            result.suggestedAnswers = suggestedAnswers.map((answer, index) => {
                                                if (typeof answer === 'string') {
                                                    return {
                                                        english: answer,
                                                        korean: '' // ë‚˜ì¤‘ì— ë²ˆì—­ ê°€ëŠ¥
                                                    };
                                                }
                                                return answer;
                                            });
                                        }
                                        
                                        // ë²ˆì—­ ì™„ë£Œ í›„ ë³µìŠµìš© ì €ì¥
                                        if (saveForReview && result.translation) {
                                            const saveResult = saveNotificationForReview(
                                                finalText,
                                                result.translation,
                                                result.suggestedAnswers
                                            );
                                            
                                            if (saveResult.success) {
                                                console.log(`ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ì €ì¥ ì™„ë£Œ (ID: ${saveResult.reviewId}, ì´ ${saveResult.totalReviews}ê°œ)`);
                                            } else {
                                                console.warn('ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', saveResult.error);
                                            }
                                        }
                                    } catch (parseError) {
                                        console.error('ë²ˆì—­ ê²°ê³¼ íŒŒì‹± ì˜¤ë¥˜:', parseError);
                                    }
                                }
                            }
                        }
                    } catch (translateError) {
                        console.error('ë²ˆì—­ ì¤‘ ì˜¤ë¥˜:', translateError);
                        // ë²ˆì—­ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
                    }
                }

                // 6. ì±„íŒ…ì— ì¶”ê°€
                if (addToChat && window.appInstance && window.appInstance.addProcessedNotification) {
                    window.appInstance.addProcessedNotification(result);
                } else if (addToChat) {
                    // ì•± ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í˜•ì‹ìœ¼ë¡œ ì¶”ê°€
                    const notificationData = {
                        packageName: packageName,
                        title: title,
                        text: cleanedText,
                        timestamp: Date.now()
                    };
                    
                    if (window.appInstance && window.appInstance.addNotificationMessage) {
                        window.appInstance.addNotificationMessage(notificationData);
                    }
                }

                console.log('ì•Œë¦¼ í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì™„ë£Œ:', result);
                return result;

            } catch (error) {
                console.error('ì•Œë¦¼ í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                return {
                    success: false,
                    error: error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
                };
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ì•ˆë“œë¡œì´ë“œ ë¸Œë¦¬ì§€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
        window.handleNotification = handleNotification;
        window.checkNotificationPermission = checkNotificationPermission;
        window.requestNotificationPermission = requestNotificationPermission;
        window.processNotification = processNotification;
        window.saveNotificationForReview = saveNotificationForReview;
        window.getNotificationReviews = getNotificationReviews;
        window.deleteNotificationReview = deleteNotificationReview;

        // Message Component
        function Message({ message }) {
            const isUser = message.role === 'user';

            return (
                <div className={`flex items-start space-x-3 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}`}>
                    {/* Avatar */}
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                        isUser 
                            ? 'bg-gray-300' 
                            : 'bg-gradient-to-br from-blue-500 to-purple-600'
                    }`}>
                        {isUser ? (
                            <svg className="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        ) : (
                            <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                            </svg>
                        )}
                    </div>

                    {/* Message Content */}
                    <div className={`flex-1 ${isUser ? 'flex justify-end' : ''}`}>
                        <div className={`inline-block max-w-[85%] md:max-w-[75%] ${
                            isUser 
                                ? 'bg-blue-500 text-white rounded-2xl rounded-tr-sm' 
                                : 'bg-gray-100 text-gray-800 rounded-2xl rounded-tl-sm'
                        } px-4 py-3`}>
                            <p className="text-[15px] leading-relaxed whitespace-pre-wrap break-words">
                                {message.content}
                            </p>
                        </div>
                        <div className={`text-xs text-gray-500 mt-1 ${isUser ? 'text-right' : 'text-left'} px-1`}>
                            {message.timestamp.toLocaleTimeString('ko-KR', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        // ChatInput Component
        function ChatInput({ onSendMessage, disabled }) {
            const [input, setInput] = useState('');
            const textareaRef = useRef(null);

            useEffect(() => {
                if (textareaRef.current) {
                    textareaRef.current.style.height = 'auto';
                    textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`;
                }
            }, [input]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (input.trim() && !disabled) {
                    onSendMessage(input);
                    setInput('');
                    if (textareaRef.current) {
                        textareaRef.current.style.height = 'auto';
                    }
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSubmit(e);
                }
            };

            return (
                <form onSubmit={handleSubmit} className="relative">
                    <div className="flex items-end space-x-3 bg-white border border-gray-300 rounded-2xl px-4 py-3 shadow-sm focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200 transition-all">
                        <textarea
                            ref={textareaRef}
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyDown={handleKeyDown}
                            placeholder="ì˜¤ëŠ˜ì€ ì–´ë–¤ê²ƒì„ ë°°ì›Œë³¼ê¹Œìš”?"
                            disabled={disabled}
                            rows={1}
                            className="flex-1 resize-none border-none outline-none bg-transparent text-gray-800 placeholder-gray-400 text-[15px] max-h-32 overflow-y-auto"
                            style={{ minHeight: '24px' }}
                        />
                        <button
                            type="submit"
                            disabled={!input.trim() || disabled}
                            className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-colors ${
                                input.trim() && !disabled
                                    ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                    : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            }`}
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </form>
            );
        }

        // ì•Œë¦¼ë²ˆì—­ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (Lesson í˜ì´ì§€)
        function NotificationTranslationPage() {
            const [wordData, setWordData] = useState({
                word: '',
                meaning: '',
                example: ''
            });
            const [isLoadingWord, setIsLoadingWord] = useState(false);
            
            const [grammarData, setGrammarData] = useState({
                point: '',
                explanation: '',
                example: ''
            });
            const [isLoadingGrammar, setIsLoadingGrammar] = useState(false);

            // Gemini APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ìƒì„±
            const generateTodayWord = async () => {
                const apiKey = localStorage.getItem('gemini_api_key');
                if (!apiKey) {
                    setWordData({
                        word: 'API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤',
                        meaning: 'Profile í˜ì´ì§€ì—ì„œ API í‚¤ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”',
                        example: ''
                    });
                    return;
                }

                setIsLoadingWord(true);
                try {
                    const prompt = `Generate today's English word for learning.

IMPORTANT REQUIREMENTS:
1. Word frequency: Choose a word that is less common (not too high frequency). Avoid very common words that are repeated frequently. Select a word that is useful but not overly common.
2. Uniqueness: Provide a NEW word every time. Consider whether this word has been used before and absolutely do NOT repeat any previously used words. Even though you cannot see the actual history, this instruction will help strengthen internal randomness and ensure variety.

CRITICAL INSTRUCTION: Your response MUST contain ONLY valid JSON data. Absolutely NO other text, explanations, comments, markdown formatting, or any additional content is allowed. Return ONLY the JSON object with this exact structure:
{
  "word": "English word",
  "meaning": "Korean meaning",
  "example": "Example sentence in English with Korean translation"
}

Choose a useful, practical English word that learners should know. Make it educational and relevant for daily use, but ensure it is less common and different from previous words.

MANDATORY: Return ONLY the JSON object. No text before the JSON. No text after the JSON. No explanations. No comments. Pure JSON only.`;

                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    role: 'user',
                                    parts: [{ text: prompt }]
                                }],
                                generationConfig: {
                                    temperature: 0.7,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 500,
                                    responseMimeType: 'application/json'
                                }
                            })
                        }
                    );

                    if (!response.ok) {
                        throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                    }

                    const data = await response.json();
                    const content = data.candidates[0]?.content?.parts[0]?.text;
                    
                    if (content) {
                        // JSON íŒŒì‹±
                        const jsonData = JSON.parse(content);
                        setWordData({
                            word: jsonData.word || '',
                            meaning: jsonData.meaning || '',
                            example: jsonData.example || ''
                        });
                    }
                } catch (error) {
                    console.error('Error generating word:', error);
                    setWordData({
                        word: 'ì˜¤ë¥˜ ë°œìƒ',
                        meaning: 'ë‹¨ì–´ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        example: ''
                    });
                } finally {
                    setIsLoadingWord(false);
                }
            };

            // Gemini APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ëŠ˜ì˜ ë¬¸ë²• í¬ì¸íŠ¸ ìƒì„±
            const generateGrammarPoint = async () => {
                const apiKey = localStorage.getItem('gemini_api_key');
                if (!apiKey) {
                    setGrammarData({
                        point: 'API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤',
                        explanation: 'Profile í˜ì´ì§€ì—ì„œ API í‚¤ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”',
                        example: ''
                    });
                    return;
                }

                setIsLoadingGrammar(true);
                
                const prompt = `Generate a grammar point for beginner to intermediate English learners.

IMPORTANT REQUIREMENTS:
1. Randomly select one grammar point from various types such as: tenses (present, past, future, perfect tenses), modal verbs, relative pronouns, subjunctive mood, passive voice, conditional sentences, gerunds and infinitives, phrasal verbs, etc.
2. Ensure variety - do not repeat grammar points that were previously provided. Choose a different grammar topic each time.
3. Difficulty level: Avoid focusing only on very basic grammar (such as "be" verb, simple present tense). Include grammar points that are appropriate for beginner to intermediate level learners - not too easy, not too advanced.

CRITICAL INSTRUCTION: Your response MUST contain ONLY valid JSON data. Absolutely NO other text, explanations, comments, markdown formatting, or any additional content is allowed. Return ONLY the JSON object with this exact structure:
{
  "point": "Grammar point name in English",
  "explanation": "Korean explanation of the grammar point",
  "example": "Example sentence in English with Korean translation"
}

Make the explanation clear and easy to understand for beginner to intermediate learners.

MANDATORY: Return ONLY the JSON object. No text before the JSON. No text after the JSON. No explanations. No comments. Pure JSON only.`;

                // API í˜¸ì¶œ í•¨ìˆ˜
                const callAPI = async () => {
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    role: 'user',
                                    parts: [{ text: prompt }]
                                }],
                                generationConfig: {
                                    temperature: 0.7,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 500,
                                    responseMimeType: 'application/json'
                                }
                            })
                        }
                    );

                    if (!response.ok) {
                        throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                    }

                    const data = await response.json();
                    const content = data.candidates[0]?.content?.parts[0]?.text;
                    
                    if (!content) {
                        throw new Error('ì‘ë‹µ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤');
                    }

                    // JSON íŒŒì‹±
                    const jsonData = JSON.parse(content);
                    return {
                        point: jsonData.point || '',
                        explanation: jsonData.explanation || '',
                        example: jsonData.example || ''
                    };
                };

                // ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3ë²ˆ, 2ì´ˆ ê°„ê²©)
                const maxRetries = 3;
                const retryDelay = 2000; // 2ì´ˆ
                let lastError = null;

                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        const result = await callAPI();
                        setGrammarData(result);
                        setIsLoadingGrammar(false);
                        return; // ì„±ê³µ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ
                    } catch (error) {
                        lastError = error;
                        console.error(`ë¬¸ë²• í¬ì¸íŠ¸ ìƒì„± ì‹œë„ ${attempt}/${maxRetries} ì‹¤íŒ¨:`, error);
                        
                        // ë§ˆì§€ë§‰ ì‹œë„ê°€ ì•„ë‹ˆë©´ 2ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
                        if (attempt < maxRetries) {
                            await new Promise(resolve => setTimeout(resolve, retryDelay));
                        }
                    }
                }

                // ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ í‘œì‹œ
                console.error('ë¬¸ë²• í¬ì¸íŠ¸ ìƒì„± ìµœì¢… ì‹¤íŒ¨:', lastError);
                setGrammarData({
                    point: 'ì˜¤ë¥˜ ë°œìƒ',
                    explanation: 'ë¬¸ë²• í¬ì¸íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (3íšŒ ì‹œë„ ì‹¤íŒ¨)',
                    example: ''
                });
                setIsLoadingGrammar(false);
            };

            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì˜¤ëŠ˜ì˜ ë‹¨ì–´ì™€ ë¬¸ë²• í¬ì¸íŠ¸ ìƒì„±
            useEffect(() => {
                generateTodayWord();
                generateGrammarPoint();
            }, []);

            return (
                <div className="max-w-3xl mx-auto px-4 py-8">
                    <h1 className="text-3xl font-bold text-gray-800 mb-8">Today's Essential English</h1>
                    
                    <div className="flex flex-col gap-6">
                        {/* Word of Today */}
                        <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-semibold text-blue-600">Word of Today</h2>
                                <button
                                    onClick={generateTodayWord}
                                    disabled={isLoadingWord}
                                    className="text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400 transition-colors"
                                >
                                    {isLoadingWord ? 'ìƒì„± ì¤‘...' : 'ğŸ”„ ìƒˆë¡œê³ ì¹¨'}
                                </button>
                            </div>
                            {isLoadingWord ? (
                                <div className="flex items-center justify-center py-8">
                                    <div className="flex space-x-1">
                                        <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                                        <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                                        <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="border-b border-gray-200 pb-3">
                                        <p className="text-sm text-gray-500 mb-1">ë‹¨ì–´</p>
                                        <p className="text-lg font-medium text-gray-800">{wordData.word || '-'}</p>
                                    </div>
                                    <div className="border-b border-gray-200 pb-3">
                                        <p className="text-sm text-gray-500 mb-1">ëœ»</p>
                                        <p className="text-base text-gray-700">{wordData.meaning || '-'}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500 mb-1">ì˜ˆë¬¸</p>
                                        <p className="text-base text-gray-700 italic">{wordData.example || '-'}</p>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Grammar Point */}
                        <div className="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-semibold text-green-600">Grammar Point</h2>
                                <button
                                    onClick={generateGrammarPoint}
                                    disabled={isLoadingGrammar}
                                    className="text-sm text-green-600 hover:text-green-700 disabled:text-gray-400 transition-colors"
                                >
                                    {isLoadingGrammar ? 'ìƒì„± ì¤‘...' : 'ğŸ”„ ìƒˆë¡œê³ ì¹¨'}
                                </button>
                            </div>
                            {isLoadingGrammar ? (
                                <div className="flex items-center justify-center py-8">
                                    <div className="flex space-x-1">
                                        <div className="w-2 h-2 bg-green-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                                        <div className="w-2 h-2 bg-green-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                                        <div className="w-2 h-2 bg-green-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="border-b border-gray-200 pb-3">
                                        <p className="text-sm text-gray-500 mb-1">ë¬¸ë²• í¬ì¸íŠ¸</p>
                                        <p className="text-lg font-medium text-gray-800">{grammarData.point || '-'}</p>
                                    </div>
                                    <div className="border-b border-gray-200 pb-3">
                                        <p className="text-sm text-gray-500 mb-1">ì„¤ëª…</p>
                                        <p className="text-base text-gray-700">{grammarData.explanation || '-'}</p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500 mb-1">ì˜ˆë¬¸</p>
                                        <p className="text-base text-gray-700 italic">{grammarData.example || '-'}</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // ì¥ì†Œë³„ íšŒí™” ë¬¸ì¥ ìƒì„± í•¨ìˆ˜
        const generateLocationPhrases = async (locationName) => {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!apiKey) {
                throw new Error('API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. Profile í˜ì´ì§€ì—ì„œ API í‚¤ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.');
            }

            const prompt = `ë‹¹ì‹ ì€ ì‚¬ìš©ìì—ê²Œ ${locationName} ìƒí™©ì— ë§ëŠ” ì‹¤ì „ ì˜ì–´ íšŒí™” ë¬¸ì¥ì„ ì œê³µí•˜ëŠ” Contextflow ë°ì´í„° ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì§€ì¹¨ (Instruction)
1. **ì¶œë ¥ í˜•ì‹:** ë‹¹ì‹ ì˜ ë‹µë³€ì€ **ë°˜ë“œì‹œ JSON ë°°ì—´ í˜•ì‹**ìœ¼ë¡œ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì„¤ëª…ì´ë‚˜ í…ìŠ¤íŠ¸ëŠ” ì¼ì ˆ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
2. **í•„ìˆ˜ í‚¤:** ê° íšŒí™” ë¬¸ì¥ì€ ë°˜ë“œì‹œ **\`korean\`, \`english\`, \`context\`**ì˜ ì„¸ ê°€ì§€ í‚¤ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
3. **ë¬¸ìì—´ ì•ˆì „ ê·œì¹™ (Unterminated String ë°©ì§€):**
    * **ëª¨ë“  ë¬¸ìì—´ ê°’**ì€ ë°˜ë“œì‹œ **í°ë”°ì˜´í‘œ(" ")**ë¡œ ì‹œì‘í•˜ê³  ëë‚˜ì•¼ í•©ë‹ˆë‹¤.
    * ë§Œì•½ íšŒí™” ë¬¸ì¥ ë‚´ìš©(ì˜ˆ: \`english\` ê°’) ì•ˆì— í°ë”°ì˜´í‘œê°€ í¬í•¨ë  ê²½ìš°, **ë°˜ë“œì‹œ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì(\\\\)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬(\\\\")**í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆì‹œ: O'clock -> O\\'clock)
4. **ë¬¸ì¥ ê°œìˆ˜:** ì‚¬ìš©ìì—ê²Œ ë¶€ë‹´ì„ ì£¼ì§€ ì•Šë„ë¡ ë¬¸ì¥ì€ **ìµœì†Œ 3ê°œ, ìµœëŒ€ 5ê°œ**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
5. **í˜„ì¬ ìƒí™©:** ${locationName} (ì£¼ë¬¸, ê²°ì œ, ìš”ì²­, ì•ˆë‚´ ë“± ê´€ë ¨ ìƒí™©)

CRITICAL - SENTENCE STYLE REQUIREMENT: All conversation phrases MUST be written in short, simple, and clear conversational style (êµ¬ì–´ì²´). Use everyday spoken English that is easy to understand and use. Avoid complex sentence structures, formal language, or overly complicated expressions. Keep sentences concise and natural. Minimize the use of special characters, punctuation marks, or symbols within the sentences. Use only standard punctuation (periods, commas, question marks) when absolutely necessary.

IMPORTANT - VARIETY REQUIREMENT: This request may be called multiple times (when user refreshes). You must generate COMPLETELY NEW sentences that have NOT been presented before. Include diverse situations and scenarios. Avoid repeating any previous sentences. Create fresh, unique conversation phrases every time.

## ìš”êµ¬ë˜ëŠ” ì¶œë ¥ JSON ì˜ˆì‹œ (Format Example)
[
  {
    "korean": "ë©”ë‰´íŒì„ ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?",
    "english": "Can I see the menu, please?",
    "context": "Ordering"
  },
  {
    "korean": "ì´ê±° í¬ì¥í•´ ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?",
    "english": "Could I get this to go?",
    "context": "Request"
  }
]

STRICT REQUIREMENTS:
- Output ONLY the JSON array
- NO text before the JSON array
- NO text after the JSON array
- NO explanations
- NO comments
- NO markdown formatting
- NO code blocks
- Pure JSON array only - nothing else

ìœ„ì— ëª…ì‹œëœ ì§€ì¹¨ê³¼ ì¶œë ¥ ì˜ˆì‹œë¥¼ ì—„ê²©í•˜ê²Œ ì¤€ìˆ˜í•˜ì—¬ ${locationName} íšŒí™” ë¬¸ì¥ì„ JSON ë°°ì—´ í˜•ì‹ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

            // API í˜¸ì¶œ í•¨ìˆ˜
            const callAPI = async () => {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                role: 'user',
                                parts: [{ text: prompt }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 1000,
                                responseMimeType: 'application/json'
                            }
                        })
                    }
                );

                if (!response.ok) {
                    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const data = await response.json();
                const content = data.candidates[0]?.content?.parts[0]?.text;
                
                if (!content) {
                    throw new Error('ì‘ë‹µ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤');
                }

                // JSON íŒŒì‹±
                const phrases = JSON.parse(content);
                if (!Array.isArray(phrases)) {
                    throw new Error('ì‘ë‹µì´ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤');
                }
                return phrases;
            };

            // ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3ë²ˆ, 2ì´ˆ ê°„ê²©)
            const maxRetries = 3;
            const retryDelay = 2000; // 2ì´ˆ
            let lastError = null;

            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                try {
                    const result = await callAPI();
                    return result; // ì„±ê³µ ì‹œ ê²°ê³¼ ë°˜í™˜
                } catch (error) {
                    lastError = error;
                    console.error(`íšŒí™” ë¬¸ì¥ ìƒì„± ì‹œë„ ${attempt}/${maxRetries} ì‹¤íŒ¨:`, error);
                    
                    // ë§ˆì§€ë§‰ ì‹œë„ê°€ ì•„ë‹ˆë©´ 2ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
                    if (attempt < maxRetries) {
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                    }
                }
            }

            // ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ throw
            console.error('íšŒí™” ë¬¸ì¥ ìƒì„± ìµœì¢… ì‹¤íŒ¨:', lastError);
            throw new Error(`íšŒí™” ë¬¸ì¥ ìƒì„± ì‹¤íŒ¨ (3íšŒ ì‹œë„ ì‹¤íŒ¨): ${lastError.message}`);
        };

        // ìƒˆë¡œê³ ì¹¨ ì „ìš© í•¨ìˆ˜
        const refreshLocationPhrases = async (locationName, contentElement) => {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!apiKey) {
                alert('API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. Profile í˜ì´ì§€ì—ì„œ API í‚¤ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.');
                return;
            }

            const prompt = `ë‹¹ì‹ ì€ ì‚¬ìš©ìì—ê²Œ ${locationName} ìƒí™©ì— ë§ëŠ” ì‹¤ì „ ì˜ì–´ íšŒí™” ë¬¸ì¥ì„ ì œê³µí•˜ëŠ” Contextflow ë°ì´í„° ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì§€ì¹¨ (Instruction)
1. **ì¶œë ¥ í˜•ì‹:** ë‹¹ì‹ ì˜ ë‹µë³€ì€ **ë°˜ë“œì‹œ JSON ë°°ì—´ í˜•ì‹**ìœ¼ë¡œ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì„¤ëª…ì´ë‚˜ í…ìŠ¤íŠ¸ëŠ” ì¼ì ˆ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
2. **í•„ìˆ˜ í‚¤:** ê° íšŒí™” ë¬¸ì¥ì€ ë°˜ë“œì‹œ **\`korean\`, \`english\`, \`context\`**ì˜ ì„¸ ê°€ì§€ í‚¤ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
3. **ë¬¸ìì—´ ì•ˆì „ ê·œì¹™ (Unterminated String ë°©ì§€):**
    * **ëª¨ë“  ë¬¸ìì—´ ê°’**ì€ ë°˜ë“œì‹œ **í°ë”°ì˜´í‘œ(" ")**ë¡œ ì‹œì‘í•˜ê³  ëë‚˜ì•¼ í•©ë‹ˆë‹¤.
    * ë§Œì•½ íšŒí™” ë¬¸ì¥ ë‚´ìš©(ì˜ˆ: \`english\` ê°’) ì•ˆì— í°ë”°ì˜´í‘œê°€ í¬í•¨ë  ê²½ìš°, **ë°˜ë“œì‹œ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì(\\\\)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬(\\\\")**í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆì‹œ: O'clock -> O\\'clock)
4. **ë¬¸ì¥ ê°œìˆ˜:** ì‚¬ìš©ìì—ê²Œ ë¶€ë‹´ì„ ì£¼ì§€ ì•Šë„ë¡ ë¬¸ì¥ì€ **ìµœì†Œ 3ê°œ, ìµœëŒ€ 5ê°œ**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
5. **í˜„ì¬ ìƒí™©:** ${locationName} (ì£¼ë¬¸, ê²°ì œ, ìš”ì²­, ì•ˆë‚´ ë“± ê´€ë ¨ ìƒí™©)

CRITICAL - SENTENCE STYLE REQUIREMENT: All conversation phrases MUST be written in short, simple, and clear conversational style (êµ¬ì–´ì²´). Use everyday spoken English that is easy to understand and use. Avoid complex sentence structures, formal language, or overly complicated expressions. Keep sentences concise and natural. Minimize the use of special characters, punctuation marks, or symbols within the sentences. Use only standard punctuation (periods, commas, question marks) when absolutely necessary.

CRITICAL - MAXIMUM VARIETY REQUIREMENT: This is a REFRESH request. You MUST generate COMPLETELY NEW sentences that are TOTALLY DIFFERENT from any previously presented sentences. Create 3-5 completely new situations and conversation phrases that have NEVER been shown before. Include diverse scenarios, different contexts, and unique conversation patterns. Absolutely avoid any repetition of previous content.

## ìš”êµ¬ë˜ëŠ” ì¶œë ¥ JSON ì˜ˆì‹œ (Format Example)
[
  {
    "korean": "ë©”ë‰´íŒì„ ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?",
    "english": "Can I see the menu, please?",
    "context": "Ordering"
  },
  {
    "korean": "ì´ê±° í¬ì¥í•´ ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?",
    "english": "Could I get this to go?",
    "context": "Request"
  }
]

STRICT REQUIREMENTS:
- Output ONLY the JSON array
- NO text before the JSON array
- NO text after the JSON array
- NO explanations
- NO comments
- NO markdown formatting
- NO code blocks
- Pure JSON array only - nothing else

ìœ„ì— ëª…ì‹œëœ ì§€ì¹¨ê³¼ ì¶œë ¥ ì˜ˆì‹œë¥¼ ì—„ê²©í•˜ê²Œ ì¤€ìˆ˜í•˜ì—¬ ${locationName} íšŒí™” ë¬¸ì¥ì„ JSON ë°°ì—´ í˜•ì‹ìœ¼ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

            // API í˜¸ì¶œ í•¨ìˆ˜
            const callAPI = async () => {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                role: 'user',
                                parts: [{ text: prompt }]
                            }],
                            generationConfig: {
                                temperature: 0.8,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 1000,
                                responseMimeType: 'application/json' // JSON í˜•ì‹ ê°•ì œ
                            }
                        })
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const data = await response.json();
                const content = data.candidates[0]?.content?.parts[0]?.text;
                
                if (!content) {
                    throw new Error('ì‘ë‹µ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤');
                }

                // JSON íŒŒì‹± (ì•ˆì „í•œ íŒŒì‹±)
                let phrases;
                try {
                    phrases = JSON.parse(content);
                } catch (parseError) {
                    console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    throw new Error('JSON íŒŒì‹± ì‹¤íŒ¨');
                }

                if (!Array.isArray(phrases)) {
                    throw new Error('ì‘ë‹µì´ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤');
                }

                // ê° í•­ëª©ì´ í•„ìˆ˜ í‚¤ë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸
                if (phrases.length > 0 && (!phrases[0].korean || !phrases[0].english || !phrases[0].context)) {
                    throw new Error('ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }

                return phrases;
            };

            // ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3ë²ˆ, 2ì´ˆ ê°„ê²©) - JSON íŒŒì‹± ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ í•„ìˆ˜ ë¡œì§
            const maxRetries = 3;
            const retryDelay = 2000; // 2ì´ˆ
            let lastError = null;

            // ë¡œë”© í‘œì‹œ
            const ul = contentElement.querySelector('ul');
            if (ul) {
                ul.innerHTML = `
                    <li class="flex items-center justify-center py-8">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                        </div>
                        <span class="ml-3 text-gray-600">ìƒˆë¡œìš´ íšŒí™” ë¬¸ì¥ì„ ìƒì„±í•˜ëŠ” ì¤‘...</span>
                    </li>
                `;
            }

            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                try {
                    const result = await callAPI();
                    
                    // ê¸°ì¡´ ul ë‚´ìš© êµì²´
                    if (ul) {
                        ul.innerHTML = '';
                        result.forEach((phrase, index) => {
                            const li = document.createElement('li');
                            li.className = 'border-b border-gray-100 pb-4 last:border-b-0';

                            const container = document.createElement('div');
                            container.className = 'flex items-start space-x-3';

                            const badge = document.createElement('span');
                            const contextText = phrase.context || 'Info';
                            badge.className = `inline-flex items-center justify-center px-2 py-1 rounded text-xs font-semibold flex-shrink-0 mt-1 bg-blue-100 text-blue-700`;
                            badge.textContent = contextText;

                            const content = document.createElement('div');
                            content.className = 'flex-1';

                            const english = document.createElement('p');
                            english.className = 'text-lg font-medium text-gray-800 mb-1';
                            english.textContent = phrase.english;

                            const korean = document.createElement('p');
                            korean.className = 'text-sm text-gray-600';
                            korean.textContent = phrase.korean;

                            content.appendChild(english);
                            content.appendChild(korean);
                            container.appendChild(badge);
                            container.appendChild(content);
                            li.appendChild(container);
                            ul.appendChild(li);
                        });
                    }
                    return; // ì„±ê³µ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ
                } catch (error) {
                    lastError = error;
                    console.error(`íšŒí™” ë¬¸ì¥ ìƒˆë¡œê³ ì¹¨ ì‹œë„ ${attempt}/${maxRetries} ì‹¤íŒ¨:`, error);
                    
                    // ë§ˆì§€ë§‰ ì‹œë„ê°€ ì•„ë‹ˆë©´ 2ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
                    if (attempt < maxRetries) {
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                    }
                }
            }

            // ëª¨ë“  ì‹œë„ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ í‘œì‹œ (ê°„ê²°í•˜ê³  ì¹œì ˆí•œ ë©”ì‹œì§€)
            console.error('íšŒí™” ë¬¸ì¥ ìƒˆë¡œê³ ì¹¨ ìµœì¢… ì‹¤íŒ¨:', lastError);
            if (ul) {
                ul.innerHTML = `
                    <li class="border-b border-red-200 pb-4">
                        <div class="flex items-start space-x-3">
                            <span class="inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-semibold flex-shrink-0 mt-1 bg-red-100 text-red-700">!</span>
                            <div class="flex-1">
                                <p class="text-lg font-medium text-red-800 mb-1">ì˜¤ë¥˜ ë°œìƒ</p>
                                <p class="text-sm text-gray-600">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
                            </div>
                        </div>
                    </li>
                `;
            }
        };

        // íšŒí™” í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        function ConversationPage() {
            const [showMore, setShowMore] = useState(false);
            
            const additionalPlaces = [
                { emoji: 'âœˆï¸', name: 'ê³µí•­' },
                { emoji: 'ğŸ¨', name: 'í˜¸í…”' },
                { emoji: 'ğŸ¥', name: 'ë³‘ì›' },
                { emoji: 'ğŸ›ï¸', name: 'ì‡¼í•‘ëª°' },
                { emoji: 'ğŸš‡', name: 'ì§€í•˜ì² ' },
                { emoji: 'ğŸš•', name: 'íƒì‹œ' },
                { emoji: 'ğŸ¦', name: 'ì€í–‰' },
                { emoji: 'ğŸ¬', name: 'ì˜í™”ê´€' },
            ];

            // ì¥ì†Œë³„ íšŒí™” ë¬¸ì¥ í‘œì‹œ í•¨ìˆ˜
            const displayPhrases = async (locationName, element) => {
                // ê¸°ì¡´ì— í‘œì‹œëœ íšŒí™” ë¬¸ì¥ ì˜ì—­ í™•ì¸ (ë¡œë”© ì˜ì—­ ì œì™¸)
                const allAreas = element.parentElement.querySelectorAll(`[data-location="${locationName}"]`);
                const existingArea = Array.from(allAreas).find(area => {
                    const dataLocation = area.getAttribute('data-location');
                    return dataLocation === locationName && !dataLocation.includes('-loading');
                });
                
                // ê¸°ì¡´ ì˜ì—­ì´ ìˆìœ¼ë©´ í† ê¸€ (ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°)
                if (existingArea) {
                    const currentDisplay = existingArea.style.display || 'block';
                    if (currentDisplay === 'none') {
                        // ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ë³´ì´ê¸°
                        existingArea.style.display = 'block';
                    } else {
                        // ë³´ì´ê³  ìˆìœ¼ë©´ ìˆ¨ê¸°ê¸°
                        existingArea.style.display = 'none';
                    }
                    return; // í† ê¸€ë§Œ í•˜ê³  í•¨ìˆ˜ ì¢…ë£Œ
                }

                // ì²« í´ë¦­ì´ë©´ ìƒˆë¡œìš´ ë¬¸ì¥ ìƒì„±
                // ë¡œë”© ì˜ì—­ ìƒì„±
                const loadingArea = document.createElement('div');
                loadingArea.setAttribute('data-location', `${locationName}-loading`);
                loadingArea.className = 'bg-white border border-gray-200 rounded-lg p-8 shadow-sm mt-4';
                loadingArea.innerHTML = `
                    <div class="flex items-center justify-center">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                            <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                        </div>
                        <span class="ml-3 text-gray-600">íšŒí™” ë¬¸ì¥ì„ ìƒì„±í•˜ëŠ” ì¤‘...</span>
                    </div>
                `;
                element.insertAdjacentElement('afterend', loadingArea);

                try {
                    const result = await generateLocationPhrases(locationName);
                    
                    // ë¡œë”© ì˜ì—­ ì œê±°
                    loadingArea.remove();

                    // íšŒí™” ë¬¸ì¥ ëª©ë¡ ìƒì„±
                    const phrasesArea = document.createElement('div');
                    phrasesArea.setAttribute('data-location', locationName);
                    phrasesArea.className = 'bg-white border border-gray-200 rounded-lg p-6 shadow-sm mt-4';
                    phrasesArea.style.display = 'block'; // ì´ˆê¸° ìƒíƒœ: ë³´ì´ê¸°

                    const titleContainer = document.createElement('div');
                    titleContainer.className = 'flex items-center justify-between mb-4';
                    
                    const title = document.createElement('h2');
                    title.className = 'text-2xl font-semibold text-gray-800';
                    title.textContent = `${locationName} íšŒí™” ë¬¸ì¥`;
                    titleContainer.appendChild(title);

                    const refreshButton = document.createElement('button');
                    refreshButton.className = 'px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center space-x-1';
                    refreshButton.innerHTML = `
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span>ìƒˆë¡œê³ ì¹¨</span>
                    `;
                    refreshButton.onclick = (e) => {
                        e.stopPropagation();
                        refreshLocationPhrases(locationName, phrasesArea);
                    };
                    titleContainer.appendChild(refreshButton);
                    phrasesArea.appendChild(titleContainer);

                    const ul = document.createElement('ul');
                    ul.className = 'space-y-4';

                    result.forEach((phrase, index) => {
                        const li = document.createElement('li');
                        li.className = 'border-b border-gray-100 pb-4 last:border-b-0';

                        const container = document.createElement('div');
                        container.className = 'flex items-start space-x-3';

                        const badge = document.createElement('span');
                        const contextText = phrase.context || 'Info';
                        badge.className = `inline-flex items-center justify-center px-2 py-1 rounded text-xs font-semibold flex-shrink-0 mt-1 bg-blue-100 text-blue-700`;
                        badge.textContent = contextText;

                        const content = document.createElement('div');
                        content.className = 'flex-1';

                        const english = document.createElement('p');
                        english.className = 'text-lg font-medium text-gray-800 mb-1';
                        english.textContent = phrase.english;

                        const korean = document.createElement('p');
                        korean.className = 'text-sm text-gray-600';
                        korean.textContent = phrase.korean;

                        content.appendChild(english);
                        content.appendChild(korean);
                        container.appendChild(badge);
                        container.appendChild(content);
                        li.appendChild(container);
                        ul.appendChild(li);
                    });

                    phrasesArea.appendChild(ul);
                    element.insertAdjacentElement('afterend', phrasesArea);

                } catch (error) {
                    console.error('íšŒí™” ë¬¸ì¥ ìƒì„± ì˜¤ë¥˜:', error);
                    
                    // ë¡œë”© ì˜ì—­ ì œê±°
                    loadingArea.remove();

                    // ì—ëŸ¬ ì˜ì—­ ìƒì„±
                    const errorArea = document.createElement('div');
                    errorArea.setAttribute('data-location', locationName);
                    errorArea.className = 'bg-white border border-red-200 rounded-lg p-6 shadow-sm mt-4';
                    errorArea.style.display = 'block'; // ì´ˆê¸° ìƒíƒœ: ë³´ì´ê¸°
                    errorArea.innerHTML = `
                        <h2 class="text-2xl font-semibold text-red-800 mb-2">ì˜¤ë¥˜ ë°œìƒ</h2>
                        <p class="text-gray-600">${error.message || 'íšŒí™” ë¬¸ì¥ì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>
                    `;
                    element.insertAdjacentElement('afterend', errorArea);
                }
            };

            return (
                <div className="max-w-3xl mx-auto px-4 py-8">
                    <h1 className="text-3xl font-bold text-gray-800 mb-8">ğŸŒ ì¥ì†Œë³„ ì˜ì–´ íšŒí™”</h1>
                    
                    <div className="flex flex-col gap-4">
                        {/* ì‹ë‹¹ ë°°ë„ˆ */}
                        <div 
                            onClick={(e) => displayPhrases('ì‹ë‹¹', e.currentTarget)}
                            className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer relative"
                        >
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    const existingArea = e.currentTarget.closest('.bg-white').parentElement.querySelector('[data-location="ì‹ë‹¹"]');
                                    if (existingArea) {
                                        refreshLocationPhrases('ì‹ë‹¹', existingArea);
                                    }
                                }}
                                className="absolute top-2 right-2 p-2 text-gray-400 hover:text-blue-600 transition-colors"
                                title="ìƒˆë¡œê³ ì¹¨"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                            <div className="text-4xl mb-3 text-center">ğŸ½ï¸</div>
                            <h3 className="text-xl font-semibold text-gray-800 text-center">ì‹ë‹¹</h3>
                        </div>

                        {/* ì¹´í˜ ë°°ë„ˆ */}
                        <div 
                            onClick={(e) => displayPhrases('ì¹´í˜', e.currentTarget)}
                            className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer relative"
                        >
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    const existingArea = e.currentTarget.closest('.bg-white').parentElement.querySelector('[data-location="ì¹´í˜"]');
                                    if (existingArea) {
                                        refreshLocationPhrases('ì¹´í˜', existingArea);
                                    }
                                }}
                                className="absolute top-2 right-2 p-2 text-gray-400 hover:text-blue-600 transition-colors"
                                title="ìƒˆë¡œê³ ì¹¨"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                            <div className="text-4xl mb-3 text-center">â˜•</div>
                            <h3 className="text-xl font-semibold text-gray-800 text-center">ì¹´í˜</h3>
                        </div>

                        {/* í¸ì˜ì  ë°°ë„ˆ */}
                        <div 
                            onClick={(e) => displayPhrases('í¸ì˜ì ', e.currentTarget)}
                            className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer relative"
                        >
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    const existingArea = e.currentTarget.closest('.bg-white').parentElement.querySelector('[data-location="í¸ì˜ì "]');
                                    if (existingArea) {
                                        refreshLocationPhrases('í¸ì˜ì ', existingArea);
                                    }
                                }}
                                className="absolute top-2 right-2 p-2 text-gray-400 hover:text-blue-600 transition-colors"
                                title="ìƒˆë¡œê³ ì¹¨"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                            <div className="text-4xl mb-3 text-center">ğŸª</div>
                            <h3 className="text-xl font-semibold text-gray-800 text-center">í¸ì˜ì </h3>
                        </div>

                        {/* ë” ë³´ê¸° ë²„íŠ¼ */}
                        <button
                            onClick={() => setShowMore(!showMore)}
                            className="mt-2 text-center text-blue-600 hover:text-blue-700 font-medium py-2 transition-colors"
                        >
                            ì¥ì†Œë³„ íšŒí™” ë” ë³´ê¸° {showMore ? 'â–²' : 'â–¼'}
                        </button>

                        {/* ì¶”ê°€ ì¥ì†Œë“¤ */}
                        {showMore && (
                            <div className="flex flex-col gap-4 mt-2">
                                {additionalPlaces.map((place, index) => (
                                    <div
                                        key={index}
                                        onClick={(e) => displayPhrases(place.name, e.currentTarget)}
                                        className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer relative"
                                    >
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                const existingArea = e.currentTarget.closest('.bg-white').parentElement.querySelector(`[data-location="${place.name}"]`);
                                                if (existingArea) {
                                                    refreshLocationPhrases(place.name, existingArea);
                                                }
                                            }}
                                            className="absolute top-2 right-2 p-2 text-gray-400 hover:text-blue-600 transition-colors"
                                            title="ìƒˆë¡œê³ ì¹¨"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                        </button>
                                        <div className="text-4xl mb-3 text-center">{place.emoji}</div>
                                        <h3 className="text-xl font-semibold text-gray-800 text-center">{place.name}</h3>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ë”ë¯¸ ë°ì´í„° (ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸ìš©)
        const DUMMY_NOTIFICATION_REVIEWS = [
            {
                id: 'dummy-review-1',
                originalText: 'ì•ˆë…•, ì´ë²ˆ ì£¼ë§ì— ì‹œê°„ ìˆì–´? ì»¤í”¼ í•œì” í• ë˜?',
                translation: 'Hey, are you free this weekend? Want to grab coffee?',
                suggestedAnswers: [
                    {
                        english: 'Sure, I\'d love to! What time works for you?',
                        korean: 'ë¬¼ë¡ ì´ì£ ! ëª‡ ì‹œê°€ í¸í•˜ì„¸ìš”?'
                    },
                    {
                        english: 'Sorry, I\'m busy this weekend. How about next week?',
                        korean: 'ì£„ì†¡í•´ìš”, ì´ë²ˆ ì£¼ë§ì€ ë°”ë¹ ìš”. ë‹¤ìŒ ì£¼ëŠ” ì–´ë– ì„¸ìš”?'
                    },
                    {
                        english: 'Sounds great! Let\'s meet at the usual place.',
                        korean: 'ì¢‹ì•„ìš”! í‰ì†Œì— ê°€ë˜ ê³³ì—ì„œ ë§Œë‚˜ìš”.'
                    }
                ],
                timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2ì‹œê°„ ì „
                createdAt: Date.now() - 2 * 60 * 60 * 1000
            },
            {
                id: 'dummy-review-2',
                originalText: 'ì²¨ë¶€ëœ ë¬¸ì„œë¥¼ ê²€í† í•˜ê³  ì˜¤ëŠ˜ ì—…ë¬´ ì¢…ë£Œ ì „ê¹Œì§€ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”.',
                translation: 'Please review the attached document and provide your feedback by EOD.',
                suggestedAnswers: [
                    {
                        english: 'I\'ll review it and get back to you by 5 PM today.',
                        korean: 'ê²€í† í•´ì„œ ì˜¤ëŠ˜ ì˜¤í›„ 5ì‹œê¹Œì§€ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
                    },
                    {
                        english: 'Thanks for sending this. I\'ll have my feedback ready by end of day.',
                        korean: 'ë³´ë‚´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ ì—…ë¬´ ì¢…ë£Œ ì „ê¹Œì§€ í”¼ë“œë°± ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
                    },
                    {
                        english: 'Received. I\'ll review it and send my comments before EOD.',
                        korean: 'ë°›ì•˜ìŠµë‹ˆë‹¤. ê²€í† í•´ì„œ ì—…ë¬´ ì¢…ë£Œ ì „ê¹Œì§€ ì˜ê²¬ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
                    }
                ],
                timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), // 5ì‹œê°„ ì „
                createdAt: Date.now() - 5 * 60 * 60 * 1000
            }
        ];

        // ê°œë°œ ëª¨ë“œ í™•ì¸ í•¨ìˆ˜
        const isDevelopmentMode = () => {
            // ê°œë°œ ëª¨ë“œ í™•ì¸ ë°©ë²•:
            // 1. URLì— localhost ë˜ëŠ” 127.0.0.1ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€
            // 2. localStorageì— 'dev_mode' í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€
            // 3. í™˜ê²½ ë³€ìˆ˜ë‚˜ ì „ì—­ ë³€ìˆ˜ë¡œ í™•ì¸
            const hostname = window.location.hostname;
            const isLocalhost = hostname === 'localhost' || hostname === '127.0.0.1' || hostname === '';
            const devModeFlag = localStorage.getItem('dev_mode') === 'true';
            
            return isLocalhost || devModeFlag;
        };

        // ë³µìŠµ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        function ReviewPage() {
            const [reviews, setReviews] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isDevMode, setIsDevMode] = useState(false);

            // ì €ì¥ëœ ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            useEffect(() => {
                const devMode = isDevelopmentMode();
                setIsDevMode(devMode);
                loadReviews(devMode);
            }, []);

            const loadReviews = (useDummyData = false) => {
                try {
                    setIsLoading(true);
                    
                    let savedReviews = [];
                    
                    // ê°œë°œ ëª¨ë“œì´ê³  ë”ë¯¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
                    if (useDummyData) {
                        console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ: ë”ë¯¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                        // ì‹¤ì œ ì €ì¥ëœ ë°ì´í„°ì™€ ë”ë¯¸ ë°ì´í„°ë¥¼ í•©ì¹¨
                        const actualReviews = window.getNotificationReviews ? window.getNotificationReviews(1000) : [];
                        savedReviews = [...DUMMY_NOTIFICATION_REVIEWS, ...actualReviews];
                    } else {
                        // í”„ë¡œë•ì…˜ ëª¨ë“œ: ì‹¤ì œ ì €ì¥ëœ ë°ì´í„°ë§Œ ì‚¬ìš©
                        savedReviews = window.getNotificationReviews ? window.getNotificationReviews(1000) : [];
                    }
                    
                    // ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ì´ ìœ„ë¡œ)
                    const sortedReviews = savedReviews.sort((a, b) => {
                        const timeA = new Date(a.timestamp || a.createdAt).getTime();
                        const timeB = new Date(b.timestamp || b.createdAt).getTime();
                        return timeB - timeA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ì´ ë¨¼ì €)
                    });
                    
                    setReviews(sortedReviews);
                } catch (error) {
                    console.error('ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            // ê¸°ë¡ ì‚­ì œ í•¨ìˆ˜
            const handleDeleteReview = (reviewId) => {
                if (window.confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        // ë”ë¯¸ ë°ì´í„°ì¸ ê²½ìš° localStorageì—ì„œ ì‚­ì œí•˜ì§€ ì•Šê³  ëª©ë¡ì—ì„œë§Œ ì œê±°
                        if (reviewId.startsWith('dummy-')) {
                            setReviews(prev => prev.filter(review => review.id !== reviewId));
                            console.log('ë”ë¯¸ ë°ì´í„°ê°€ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                            return;
                        }
                        
                        // ì‹¤ì œ ë°ì´í„°ì¸ ê²½ìš° localStorageì—ì„œë„ ì‚­ì œ
                        if (window.deleteNotificationReview) {
                            const success = window.deleteNotificationReview(reviewId);
                            if (success) {
                                // ëª©ë¡ì—ì„œ ì œê±°
                                setReviews(prev => prev.filter(review => review.id !== reviewId));
                                console.log('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            } else {
                                alert('ê¸°ë¡ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                        }
                    } catch (error) {
                        console.error('ê¸°ë¡ ì‚­ì œ ì˜¤ë¥˜:', error);
                        alert('ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            };

            // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
            const formatDate = (timestamp) => {
                try {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);

                    if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
                    if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
                    if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                    if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                    
                    return date.toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return 'ì•Œ ìˆ˜ ì—†ìŒ';
                }
            };

            if (isLoading) {
                return (
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <div className="flex items-center justify-center py-12">
                            <div className="flex space-x-1">
                                <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{animationDelay: '0ms'}}></div>
                                <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                                <div className="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                            </div>
                            <span className="ml-3 text-gray-600">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-4xl mx-auto px-4 py-8">
                    <div className="mb-8">
                        <div className="flex items-center justify-between mb-2">
                            <h1 className="text-3xl font-bold text-gray-800">ğŸ“š ì•Œë¦¼ ë²ˆì—­ ë³µìŠµ</h1>
                            {isDevMode && (
                                <span className="px-3 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">
                                    ğŸ”§ ê°œë°œ ëª¨ë“œ
                                </span>
                            )}
                        </div>
                        <p className="text-gray-600">
                            ì €ì¥ëœ ì•Œë¦¼ ë²ˆì—­ ê¸°ë¡ {reviews.length}ê°œ
                            {isDevMode && reviews.some(r => r.id.startsWith('dummy-')) && (
                                <span className="ml-2 text-yellow-600 text-sm">
                                    (ë”ë¯¸ ë°ì´í„° í¬í•¨)
                                </span>
                            )}
                        </p>
                    </div>

                    {reviews.length === 0 ? (
                        <div className="bg-white border-2 border-gray-200 rounded-lg p-12 text-center">
                            <div className="text-6xl mb-4">ğŸ“</div>
                            <h3 className="text-xl font-semibold text-gray-800 mb-2">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p className="text-gray-500">
                                ì•Œë¦¼ì´ ë²ˆì—­ë˜ë©´ ìë™ìœ¼ë¡œ ì—¬ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤.
                            </p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {reviews.map((review) => (
                                <div
                                    key={review.id}
                                    className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"
                                >
                                    {/* í—¤ë”: ì‹œê°„ ë° ì‚­ì œ ë²„íŠ¼ */}
                                    <div className="flex items-center justify-between mb-4 pb-3 border-b border-gray-100">
                                        <div className="flex items-center space-x-2">
                                            <span className="text-sm text-gray-500">
                                                {formatDate(review.timestamp || review.createdAt)}
                                            </span>
                                        </div>
                                        <button
                                            onClick={() => handleDeleteReview(review.id)}
                                            className="px-3 py-1.5 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors flex items-center space-x-1"
                                            title="ì‚­ì œ"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                            <span>ì‚­ì œ</span>
                                        </button>
                                    </div>

                                    {/* ì›ë¬¸ */}
                                    <div className="mb-4">
                                        <div className="flex items-center space-x-2 mb-2">
                                            <span className="text-xs font-semibold text-gray-500 uppercase">ì›ë¬¸ (í•œêµ­ì–´)</span>
                                        </div>
                                        <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                            <p className="text-lg font-medium text-gray-800 leading-relaxed">
                                                {review.originalText}
                                            </p>
                                        </div>
                                    </div>

                                    {/* ë²ˆì—­ */}
                                    {review.translation && (
                                        <div className="mb-4">
                                            <div className="flex items-center space-x-2 mb-2">
                                                <span className="text-xs font-semibold text-blue-600 uppercase">ğŸ‡¬ğŸ‡§ ë²ˆì—­ (ì˜ì–´)</span>
                                            </div>
                                            <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                                <p className="text-lg font-medium text-blue-800 leading-relaxed">
                                                    {review.translation}
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                    {/* ì œì•ˆëœ ì‘ë‹µ */}
                                    {review.suggestedAnswers && review.suggestedAnswers.length > 0 && (
                                        <div>
                                            <div className="flex items-center space-x-2 mb-2">
                                                <span className="text-xs font-semibold text-green-600 uppercase">ğŸ’¬ ì œì•ˆëœ ì‘ë‹µ</span>
                                            </div>
                                            <div className="bg-green-50 rounded-lg p-4 border border-green-200">
                                                <ul className="space-y-3">
                                                    {review.suggestedAnswers.map((answer, index) => {
                                                        // answerê°€ ê°ì²´ì¸ì§€ ë¬¸ìì—´ì¸ì§€ í™•ì¸
                                                        const isObject = typeof answer === 'object' && answer !== null;
                                                        const englishText = isObject ? answer.english : answer;
                                                        const koreanText = isObject ? answer.korean : '';
                                                        
                                                        return (
                                                            <li key={index} className="flex items-start space-x-2">
                                                                <span className="flex-shrink-0 w-6 h-6 rounded-full bg-green-200 text-green-700 flex items-center justify-center text-xs font-semibold mt-0.5">
                                                                    {index + 1}
                                                                </span>
                                                                <div className="flex-1">
                                                                    <p className="text-base font-medium text-green-800 leading-relaxed">
                                                                        {englishText}
                                                                    </p>
                                                                    {koreanText && (
                                                                        <p className="text-sm text-green-600 mt-1 leading-relaxed">
                                                                            {koreanText}
                                                                        </p>
                                                                    )}
                                                                </div>
                                                            </li>
                                                        );
                                                    })}
                                                </ul>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // ë¬¸ë²• í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        function GrammarPage() {
            return (
                <div className="max-w-3xl mx-auto px-4 py-8">
                    <h2 className="text-2xl font-semibold text-gray-800 mb-4">ë¬¸ë²•</h2>
                    <p className="text-gray-600 mb-6">ì˜ì–´ ë¬¸ë²• í•™ìŠµ ë° ì—°ìŠµ ê¸°ëŠ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    <div className="bg-white border border-gray-200 rounded-lg p-6">
                        <p className="text-gray-500">ë¬¸ë²• í•™ìŠµ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...</p>
                    </div>
                </div>
            );
        }

        // ì„¤ì • í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        function SettingsPage({ apiKey, setApiKey }) {
            // ê¸°ë³¸ ë‹‰ë„¤ì„ (ì‹¤ì œë¡œëŠ” ì‚¬ìš©ì ë°ì´í„°ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            const nickname = "ì‚¬ìš©ì";
            
            // ê°€ì…ì¼ (ì‹¤ì œë¡œëŠ” ì‚¬ìš©ì ë°ì´í„°ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            const joinDate = new Date('2024-01-01');
            const today = new Date();
            const daysSinceJoin = Math.floor((today - joinDate) / (1000 * 60 * 60 * 24));
            
            const [localApiKey, setLocalApiKey] = useState(apiKey || '');
            const [showApiKeyInput, setShowApiKeyInput] = useState(false);

            // apiKey propì´ ë³€ê²½ë˜ë©´ localApiKeyë„ ì—…ë°ì´íŠ¸
            useEffect(() => {
                setLocalApiKey(apiKey || '');
            }, [apiKey]);

            const handleSaveApiKey = () => {
                if (!localApiKey.trim()) {
                    alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                localStorage.setItem('gemini_api_key', localApiKey.trim());
                setApiKey(localApiKey.trim());
                setShowApiKeyInput(false);
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };
            
            return (
                <div className="max-w-3xl mx-auto px-4 py-8">
                    {/* ë‹‰ë„¤ì„ í—¤ë” */}
                    <h1 className="text-3xl font-bold text-gray-800 mb-6">{nickname}ë‹˜</h1>
                    
                    {/* í•¨ê»˜í•œ ì¼ìˆ˜ ë°°ë„ˆ */}
                    <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 mb-8 shadow-lg">
                        <div className="text-white">
                            <p className="text-lg font-medium mb-2">ì´ ì•±ê³¼ í•¨ê»˜í•œ ì§€</p>
                            <p className="text-4xl font-bold mb-2">{daysSinceJoin}ì¼</p>
                            <p className="text-sm opacity-90">ì˜¤ëŠ˜ë„ ì˜ì–´ ê³µë¶€ í™”ì´íŒ…! ğŸ’ª</p>
                        </div>
                    </div>
                    
                    {/* ê³„ì • ë° ì„¤ì • ì„¹ì…˜ */}
                    <h2 className="text-2xl font-semibold text-blue-600 mb-4">ê³„ì • ë° ì„¤ì •</h2>
                    
                    <div className="flex flex-col gap-4">
                        {/* Account Settings ë°°ë„ˆ */}
                        <div 
                            className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer"
                            onClick={() => setShowApiKeyInput(!showApiKeyInput)}
                        >
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4 flex-1">
                                    <div className="text-3xl">ğŸ‘¤</div>
                                    <div className="flex-1">
                                        <h3 className="text-lg font-semibold text-gray-800">Account Settings</h3>
                                        <p className="text-sm text-gray-500">API í‚¤ ë“±ë¡ ë° ê³„ì • ì •ë³´ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
                                    </div>
                                </div>
                                <div className="text-gray-400">
                                    {showApiKeyInput ? (
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                                        </svg>
                                    ) : (
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                                        </svg>
                                    )}
                                </div>
                            </div>
                            {!showApiKeyInput && !apiKey && (
                                <div className="mt-4 pt-4 border-t border-gray-200">
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            setShowApiKeyInput(true);
                                        }}
                                        className="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium"
                                    >
                                        API í‚¤ë¥¼ ë“±ë¡í•˜ì„¸ìš”
                                    </button>
                                </div>
                            )}
                            {showApiKeyInput && (
                                <div className="mt-4 pt-4 border-t border-gray-200">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Gemini API í‚¤ {apiKey ? <span className="text-green-600">(ë“±ë¡ë¨)</span> : <span className="text-red-600">(ë¯¸ë“±ë¡)</span>}
                                    </label>
                                    <div className="flex space-x-2">
                                        <input
                                            type="password"
                                            value={localApiKey}
                                            onChange={(e) => setLocalApiKey(e.target.value)}
                                            placeholder={apiKey ? "API í‚¤ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤" : "API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"}
                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            onClick={(e) => e.stopPropagation()}
                                        />
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleSaveApiKey();
                                            }}
                                            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                                        >
                                            ì €ì¥
                                        </button>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-2">
                                        Google AI Studioì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: 
                                        <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline ml-1">
                                            https://makersuite.google.com/app/apikey
                                        </a>
                                    </p>
                                    {apiKey && (
                                        <p className="text-xs text-green-600 mt-1">
                                            âœ“ API í‚¤ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì±„íŒ…ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Notification Settings ë°°ë„ˆ */}
                        <div className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer">
                            <div className="flex items-center space-x-4">
                                <div className="text-3xl">ğŸ””</div>
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800">Notification Settings</h3>
                                    <p className="text-sm text-gray-500">ì•Œë¦¼ ì„¤ì •ì„ ë³€ê²½í•˜ì„¸ìš”</p>
                                </div>
                            </div>
                        </div>

                        {/* Help & Support ë°°ë„ˆ */}
                        <div className="bg-white border-2 border-gray-200 rounded-lg p-6 shadow-sm hover:border-blue-400 hover:shadow-md transition-all cursor-pointer">
                            <div className="flex items-center space-x-4">
                                <div className="text-3xl">â“</div>
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800">Help & Support</h3>
                                    <p className="text-sm text-gray-500">ë„ì›€ë§ ë° ì§€ì›ì„ ë°›ìœ¼ì„¸ìš”</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ChatInterface Component
        function ChatInterface({ messages, onSendMessage, isLoading, currentPage, setCurrentPage }) {
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isLoading]);

            return (
                <div className="flex flex-col h-screen bg-white">
                    {/* Header */}
                    <header className="border-b border-gray-200 bg-white px-4 py-3 shadow-sm">
                        <div className="max-w-3xl mx-auto flex items-center justify-between">
                            <div>
                                <h1 className="text-xl font-semibold text-gray-800">Life Tutor</h1>
                                <p className="text-sm text-gray-500">English flows naturally into your daily life.</p>
                            </div>
                            <nav className="flex items-center space-x-4">
                                <button 
                                    onClick={() => setCurrentPage('chat')}
                                    className={`text-base font-semibold transition-colors ${
                                        currentPage === 'chat' 
                                            ? 'text-blue-600' 
                                            : 'text-gray-700 hover:text-blue-600'
                                    }`}
                                >
                                    ğŸ  home
                                </button>
                                <button 
                                    onClick={() => setCurrentPage('notification')}
                                    className={`text-base font-semibold transition-colors ${
                                        currentPage === 'notification' 
                                            ? 'text-blue-600' 
                                            : 'text-gray-700 hover:text-blue-600'
                                    }`}
                                >
                                    ğŸ“š lesson
                                </button>
                                <button 
                                    onClick={() => setCurrentPage('conversation')}
                                    className={`text-base font-semibold transition-colors ${
                                        currentPage === 'conversation' 
                                            ? 'text-blue-600' 
                                            : 'text-gray-700 hover:text-blue-600'
                                    }`}
                                >
                                    ğŸ’¬ conversation
                                </button>
                                <button 
                                    onClick={() => setCurrentPage('review')}
                                    className={`text-base font-semibold transition-colors ${
                                        currentPage === 'review' 
                                            ? 'text-blue-600' 
                                            : 'text-gray-700 hover:text-blue-600'
                                    }`}
                                >
                                    ğŸ” review
                                </button>
                                <button 
                                    onClick={() => setCurrentPage('settings')}
                                    className={`text-base font-semibold transition-colors ${
                                        currentPage === 'settings' 
                                            ? 'text-blue-600' 
                                            : 'text-gray-700 hover:text-blue-600'
                                    }`}
                                >
                                    ğŸ‘¤ profile
                                </button>
                            </nav>
                        </div>
                    </header>

                    {/* Messages Container */}
                    <div className="flex-1 overflow-y-auto px-4 py-6">
                        <div className="max-w-3xl mx-auto space-y-6">
                            {messages.length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-full text-center py-12">
                                    <div className="mb-6">
                                        <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                            </svg>
                                        </div>
                                        <h2 className="text-2xl font-semibold text-gray-800 mb-2">
                                            Life Tutorì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤
                                        </h2>
                                        <p className="text-gray-600 max-w-md">
                                            ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì—¬ ì˜ì–´ë¥¼ ì—°ìŠµí•´ë³´ì„¸ìš”. ë¬¸ë²•, ì–´íœ˜, ë°œìŒ ë“± ë‹¤ì–‘í•œ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                                        </p>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-8 w-full max-w-2xl">
                                        <button
                                            onClick={() => onSendMessage("ì˜ì–´ë¡œ ëŒ€í™” ì—°ìŠµí•˜ê³  ì‹¶ì–´ìš”")}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"
                                        >
                                            <div className="font-medium text-gray-800 mb-1">ë§í•˜ê¸° ì—°ìŠµ</div>
                                            <div className="text-sm text-gray-600">ì˜ì–´ë¡œ ëŒ€í™”ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”</div>
                                        </button>
                                        <button
                                            onClick={() => onSendMessage("ë¬¸ë²• ë„ì›€ì„ ë°›ê³  ì‹¶ì–´ìš”")}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"
                                        >
                                            <div className="font-medium text-gray-800 mb-1">ë¬¸ë²• ë„ì›€</div>
                                            <div className="text-sm text-gray-600">ë¬¸ë²• ê·œì¹™ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”</div>
                                        </button>
                                        <button
                                            onClick={() => onSendMessage("ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ë°°ìš°ê³  ì‹¶ì–´ìš”")}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"
                                        >
                                            <div className="font-medium text-gray-800 mb-1">ì–´íœ˜ í•™ìŠµ</div>
                                            <div className="text-sm text-gray-600">ë‹¨ì–´ ì§€ì‹ì„ ë„“í˜€ë³´ì„¸ìš”</div>
                                        </button>
                                        <button
                                            onClick={() => onSendMessage("ì•ˆë…•í•˜ì„¸ìš”! ì–´ë–»ê²Œ ì§€ë‚´ì„¸ìš”?")}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"
                                        >
                                            <div className="font-medium text-gray-800 mb-1">ìºì£¼ì–¼ ëŒ€í™”</div>
                                            <div className="text-sm text-gray-600">í¸í•˜ê²Œ ëŒ€í™”ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”</div>
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <>
                                    {messages.map((message) => (
                                        <Message key={message.id} message={message} />
                                    ))}
                                    {isLoading && (
                                        <div className="flex items-start space-x-3">
                                            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                                <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                                </svg>
                                            </div>
                                            <div className="flex-1">
                                                <div className="bg-gray-100 rounded-2xl rounded-tl-sm px-4 py-3 inline-block">
                                                    <div className="flex space-x-1">
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </>
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    {/* Input Area */}
                    <div className="border-t border-gray-200 bg-white px-4 py-4">
                        <div className="max-w-3xl mx-auto">
                            <ChatInput onSendMessage={onSendMessage} disabled={isLoading} />
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [messages, setMessages] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [currentPage, setCurrentPage] = useState('chat'); // 'chat', 'notification', 'grammar', 'settings'
            const [apiKey, setApiKey] = useState(() => {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
                return localStorage.getItem('gemini_api_key') || '';
            });

            // ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì±„íŒ…ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
            const addNotificationMessage = (notificationData) => {
                const notificationText = `ğŸ“± ì•Œë¦¼ ìˆ˜ì‹ \n\nì•±: ${notificationData.packageName}\nì œëª©: ${notificationData.title}\në‚´ìš©: ${notificationData.text}`;
                
                const notificationMsg = {
                    id: `notification-${Date.now()}`,
                    role: 'assistant',
                    content: notificationText,
                    timestamp: new Date(notificationData.timestamp || Date.now()),
                    isNotification: true
                };
                
                setMessages((prev) => [...prev, notificationMsg]);
            };

            // ì²˜ë¦¬ëœ ì•Œë¦¼ì„ ì±„íŒ…ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ (ë²ˆì—­ ë° ì„¤ëª… í¬í•¨)
            const addProcessedNotification = (processedResult) => {
                if (!processedResult.success) {
                    console.warn('ì²˜ë¦¬ ì‹¤íŒ¨í•œ ì•Œë¦¼:', processedResult.error);
                    return;
                }

                let content = `ğŸ“± ì•Œë¦¼ ìˆ˜ì‹ \n\n`;
                if (processedResult.title) {
                    content += `ì œëª©: ${processedResult.title}\n`;
                }
                if (processedResult.packageName && processedResult.packageName !== 'unknown') {
                    content += `ì•±: ${processedResult.packageName}\n`;
                }
                content += `\nì›ë¬¸ (í•œêµ­ì–´): ${processedResult.originalText}`;

                // ë²ˆì—­ì´ ìˆìœ¼ë©´ ì¶”ê°€
                if (processedResult.translation) {
                    content += `\n\nğŸ‡¬ğŸ‡§ ë²ˆì—­ (ì˜ì–´): ${processedResult.translation}`;
                }

                // ì„¤ëª…ì´ ìˆìœ¼ë©´ ì¶”ê°€
                if (processedResult.explanation) {
                    content += `\n\nğŸ’¡ ì„¤ëª…: ${processedResult.explanation}`;
                }

                // ì œì•ˆ ë‹µë³€ì´ ìˆìœ¼ë©´ ì¶”ê°€
                if (processedResult.suggestedAnswers && processedResult.suggestedAnswers.length > 0) {
                    content += `\n\nğŸ’¬ ì œì•ˆëœ ì‘ë‹µ:`;
                    processedResult.suggestedAnswers.forEach((answer, index) => {
                        const isObject = typeof answer === 'object' && answer !== null;
                        const englishText = isObject ? answer.english : answer;
                        const koreanText = isObject ? answer.korean : '';
                        
                        content += `\n${index + 1}. ${englishText}`;
                        if (koreanText) {
                            content += `\n   (${koreanText})`;
                        }
                    });
                }

                const notificationMsg = {
                    id: `notification-processed-${Date.now()}`,
                    role: 'assistant',
                    content: content,
                    timestamp: processedResult.timestamp || new Date(),
                    isNotification: true,
                    hasTranslation: !!processedResult.translation,
                    suggestedAnswers: processedResult.suggestedAnswers || []
                };

                setMessages((prev) => [...prev, notificationMsg]);
            };

            // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ì•ˆë“œë¡œì´ë“œ ë¸Œë¦¬ì§€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
            useEffect(() => {
                window.appInstance = {
                    addNotificationMessage: addNotificationMessage,
                    addProcessedNotification: addProcessedNotification
                };

                // ëŒ€ê¸° ì¤‘ì¸ ì•Œë¦¼ì´ ìˆìœ¼ë©´ ì²˜ë¦¬
                if (window.pendingNotifications && window.pendingNotifications.length > 0) {
                    window.pendingNotifications.forEach(notif => {
                        addNotificationMessage(notif);
                    });
                    window.pendingNotifications = [];
                }

                // ì•Œë¦¼ ê¶Œí•œ í™•ì¸ ë° ì•ˆë‚´
                const checkPermission = () => {
                    if (window.checkNotificationPermission && !window.checkNotificationPermission()) {
                        console.log('ì•Œë¦¼ ê¶Œí•œì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                    }
                };
                
                // í˜ì´ì§€ ë¡œë“œ í›„ ê¶Œí•œ í™•ì¸
                setTimeout(checkPermission, 1000);

                return () => {
                    // cleanup
                    if (window.appInstance) {
                        delete window.appInstance;
                    }
                };
            }, []);

            // AI íŠœí„° ì—­í• ì„ ìœ„í•œ ì‹œìŠ¤í…œ ëª…ë ¹ì–´
            const systemInstruction = `You are an expert English tutor AI assistant. Your role is to help users learn and practice English effectively.

IMPORTANT INSTRUCTIONS:
1. Answer questions directly and immediately without lengthy introductions or greetings
2. Provide clear, concise, and helpful responses
3. If the user asks in Korean, respond in Korean. If they ask in English, respond in English
4. If the user explicitly requests English responses (using phrases like "ì˜ì–´ë¡œ", "in English", "speak English"), always respond in English
5. Focus on practical English learning: grammar, vocabulary, pronunciation, conversation practice
6. Give examples and explanations when teaching grammar or vocabulary
7. Be encouraging and supportive
8. Do not give generic introductions - jump straight to answering the user's question

CRITICAL: When the user asks a simple question or makes a statement, ALWAYS provide:
- A direct answer to their question
- A brief explanation of the sentence structure, grammar, or key vocabulary used in their question/statement
- This helps them learn English while getting their answer

Format your response as:
[Answer to the question]

ğŸ’¡ ë¬¸ì¥ ì„¤ëª…:
[Brief explanation of grammar/vocabulary/sentence structure]

Remember: Skip introductions and get straight to the point, but always include the sentence explanation.`;

            const callGeminiAPI = async (userInput, conversationHistory) => {
                if (!apiKey) {
                    return "API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                }

                try {
                    // ì‚¬ìš©ìê°€ ì˜ì–´ë¡œ ì‘ë‹µì„ ì›í•˜ëŠ”ì§€ í™•ì¸
                    const lowerInput = userInput.toLowerCase();
                    const wantsEnglish = lowerInput.includes('ì˜ì–´ë¡œ') || 
                                       lowerInput.includes('english') || 
                                       lowerInput.includes('in english') ||
                                       lowerInput.includes('ì˜ì–´ë¡œ ë‹µë³€') ||
                                       lowerInput.includes('ì˜ì–´ë¡œ ëŒ€ë‹µ') ||
                                       lowerInput.includes('ì˜ì–´ë¡œ ë§í•´') ||
                                       lowerInput.includes('speak english') ||
                                       lowerInput.includes('answer in english');

                    // ëŒ€í™” ê¸°ë¡ì„ Gemini API í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    const chatHistory = conversationHistory.map(msg => ({
                        role: msg.role === 'user' ? 'user' : 'model',
                        parts: [{ text: msg.content }]
                    }));

                    // ìµœì‹  ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                    chatHistory.push({
                        role: 'user',
                        parts: [{ text: userInput }]
                    });

                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: chatHistory,
                                systemInstruction: {
                                    parts: [{ text: systemInstruction }]
                                },
                                generationConfig: {
                                    temperature: 0.7,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 1024,
                                }
                            })
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                    }

                    const data = await response.json();
                    let aiResponse = data.candidates[0]?.content?.parts[0]?.text || 'ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';

                    // ì˜ì–´ ì‘ë‹µì„ ì›í•˜ëŠ” ê²½ìš° ì˜ì–´ë¡œ ê°•ì œ ë³€í™˜ ìš”ì²­
                    if (wantsEnglish && !/^[A-Za-z]/.test(aiResponse.trim())) {
                        const englishResponse = await fetch(
                            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                            {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    contents: [
                                        ...chatHistory,
                                        {
                                            role: 'user',
                                            parts: [{ text: 'Please respond in English only.' }]
                                        }
                                    ],
                                    systemInstruction: {
                                        parts: [{ text: systemInstruction + '\n\nAlways respond in English when the user requests it.' }]
                                    }
                                })
                            }
                        );
                        const englishData = await englishResponse.json();
                        aiResponse = englishData.candidates[0]?.content?.parts[0]?.text || aiResponse;
                    }

                    return aiResponse;
                } catch (error) {
                    console.error('Gemini API Error:', error);
                    return `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                }
            };

            const handleSendMessage = async (content) => {
                if (!content.trim()) return;

                const userMessage = {
                    id: Date.now().toString(),
                    role: 'user',
                    content: content.trim(),
                    timestamp: new Date(),
                };

                setMessages((prev) => [...prev, userMessage]);
                setIsLoading(true);

                try {
                    // ëŒ€í™” ê¸°ë¡ì„ Gemini APIì— ì „ë‹¬
                    const conversationHistory = [...messages, userMessage];
                    const aiResponse = await callGeminiAPI(content.trim(), messages);

                    const assistantMessage = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: aiResponse,
                        timestamp: new Date(),
                    };
                    setMessages((prev) => [...prev, assistantMessage]);
                } catch (error) {
                    const errorMessage = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`,
                        timestamp: new Date(),
                    };
                    setMessages((prev) => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            const renderPage = () => {
                switch (currentPage) {
                    case 'notification':
                        return <NotificationTranslationPage />;
                    case 'conversation':
                        return <ConversationPage />;
                    case 'review':
                        return <ReviewPage />;
                    case 'grammar':
                        return <GrammarPage />;
                    case 'settings':
                        return <SettingsPage apiKey={apiKey} setApiKey={setApiKey} />;
                    default:
                        return (
                            <ChatInterface 
                                messages={messages}
                                onSendMessage={handleSendMessage}
                                isLoading={isLoading}
                                currentPage={currentPage}
                                setCurrentPage={setCurrentPage}
                            />
                        );
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {currentPage === 'chat' ? (
                        <ChatInterface 
                            messages={messages}
                            onSendMessage={handleSendMessage}
                            isLoading={isLoading}
                            currentPage={currentPage}
                            setCurrentPage={setCurrentPage}
                        />
                    ) : (
                        <div className="flex flex-col h-screen bg-white">
                            {/* Header */}
                            <header className="border-b border-gray-200 bg-white px-4 py-3 shadow-sm">
                                <div className="max-w-3xl mx-auto flex items-center justify-between">
                                    <div>
                                        <h1 className="text-xl font-semibold text-gray-800">Life Tutor</h1>
                                        <p className="text-sm text-gray-500">English flows naturally into your daily life.</p>
                                    </div>
                                    <nav className="flex items-center space-x-4">
                                        <button 
                                            onClick={() => setCurrentPage('chat')}
                                            className={`text-base font-semibold transition-colors ${
                                                currentPage === 'chat' 
                                                    ? 'text-blue-600' 
                                                    : 'text-gray-700 hover:text-blue-600'
                                            }`}
                                        >
                                            ğŸ  home
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage('notification')}
                                            className={`text-base font-semibold transition-colors ${
                                                currentPage === 'notification' 
                                                    ? 'text-blue-600' 
                                                    : 'text-gray-700 hover:text-blue-600'
                                            }`}
                                        >
                                            ğŸ“š lesson
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage('conversation')}
                                            className={`text-base font-semibold transition-colors ${
                                                currentPage === 'conversation' 
                                                    ? 'text-blue-600' 
                                                    : 'text-gray-700 hover:text-blue-600'
                                            }`}
                                        >
                                            ğŸ’¬ conversation
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage('review')}
                                            className={`text-base font-semibold transition-colors ${
                                                currentPage === 'review' 
                                                    ? 'text-blue-600' 
                                                    : 'text-gray-700 hover:text-blue-600'
                                            }`}
                                        >
                                            ğŸ” review
                                        </button>
                                        <button 
                                            onClick={() => setCurrentPage('settings')}
                                            className={`text-base font-semibold transition-colors ${
                                                currentPage === 'settings' 
                                                    ? 'text-blue-600' 
                                                    : 'text-gray-700 hover:text-blue-600'
                                            }`}
                                        >
                                            ğŸ‘¤ profile
                                        </button>
                                    </nav>
                                </div>
                            </header>
                            {/* Page Content */}
                            <div className="flex-1 overflow-y-auto">
                                {renderPage()}
                            </div>
                        </div>
                    )}
                </div>
            );        }

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

